#+title: Tangel Configuration
#+PROPERTY: header-args:emacs-lisp :tangle no
* Setup package.el
   Load use package- a popular macro in Emacs that provides declarative way  to config and load packages (eval-when-compile).
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/base.el
;;; base.el --- Package setup and basic UI configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains:
;; - Package manager setup (package.el, use-package)
;; - Basic UI configuration (disable scrollbar, toolbar, etc.)
;; - Line numbers and visual settings

;;; Code:

;; =============================================================================
;; Package Setup
;; =============================================================================

    (require 'package)
    (setq package-archives '(("melpa" . "https://melpa.org/packages/")
                             ("melpa-stable" . "https://stable.melpa.org/packages/")
                             ("org" . "https://orgmode.org/elpa/")
                             ("elpa" . "https://elpa.gnu.org/packages/")))
    (package-initialize)
    (unless (package-installed-p 'use-package)
        (package-refresh-contents)
        (package-install 'use-package))

  ;; ensures that the Emacs package archive is up-to-date before installing any new packages, by refreshing the package list if necessary.
    (unless package-archive-contents (package-refresh-contents))

    (require 'use-package)
    (setq use-package-always-ensure t)
#+end_src

# * Setup Straight.el

# Setup straight
# [[https://jeffkreeftmeijer.com/emacs-straight-use-package/][Emacs package management with straight.el and use-package]]

# #+begin_src emacs-lisp
#     ;; Install straight.el
#     ;; use Develop instead of main because potential emacs 29 bug
#   (setq straight-repository-branch "develop")

#   (defvar bootstrap-version)
#   (let ((bootstrap-file
#          (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
#         (bootstrap-version 6))
#     (unless (file-exists-p bootstrap-file)
#       (with-current-buffer
#           (url-retrieve-synchronously
#            "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"
#            'silent 'inhibit-cookies)
#         (goto-char (point-max))
#         (eval-print-last-sexp)))
#     (load bootstrap-file nil 'nomessage))
#   (straight-use-package 'org)
  
# #+end_src
* Basic UI configureation
*************** TODO Font should configure with org mode. 
*************** END

** Font Configuration
Font were set in a way in a coding environment it will use =fixed-pitch,= when its in org mode, it uses =variable-pitch= font
*** English
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/fonts.el
;;; fonts.el --- Font configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains font configuration for:
;; - English fonts (FiraCode Nerd Font Mono, Source Sans 3)
;; - Chinese fonts (Source Han Sans SC VF)

;;; Code:

  ;; Font
  ;; Set font by different mode: (set-face-attribute 'default nil :font "FONT_NAME":height: FONT_SIZE MODE/BUFFER)
  (set-face-attribute 'default nil :font "FiraCode Nerd Font Mono" :height 180)
  (set-face-attribute 'fixed-pitch nil :font "FiraCode Nerd Font Mono" :height 160)
  (set-face-attribute 'variable-pitch nil :family "Source Sans 3" :height 180 :weight 'normal)
#+end_src

*** æ±‰å­—
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/fonts.el
  ;; æ±‰å­—ï¼æ€æºé»‘ä½“
  (set-fontset-font t 'han (font-spec :family "Source Han Sans SC VF"))
  (set-face-attribute 'variable-pitch nil :family "Source Sans 3" :height 180 :weight 'normal)

(provide 'fonts)
;;; fonts.el ends here
#+end_src

** Others
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/base.el
;; =============================================================================
;; Basic UI Configuration
;; =============================================================================

  ;; Enable visible bell
  (setq visible-bell t)
  (setq ring-bell-function 'ignore)

  (setq inhibit-startup-message t)
  (scroll-bar-mode -1) ; Disable visible scrollbar
  (tool-bar-mode -1)   ; Disable the toolbar
  (tooltip-mode -1)    ; Disable tooltips
  (set-fringe-mode 10) ; Give some breathing room
  (menu-bar-mode -1)  ; Disable the menu bar

  (setq split-width-threshold 160) ; the minimum width of a window that Emacs should split horizontally instead of vertically.
  (setq split-height-threshold 80)

  (column-number-mode)
  ;; Enable line numbers for some modes
  (dolist (mode '(text-mode-hook
                  prog-mode-hook
                  conf-mode-hook))
    (add-hook mode (lambda () (display-line-numbers-mode 1))))

  ;; Override some modes which derive from the above
  (dolist (mode '(org-mode-hook))
  (add-hook mode (lambda () (display-line-numbers-mode 0))))
  ; Wrap text
  (global-visual-line-mode t)

(provide 'base)
;;; base.el ends here
#+end_src

#+RESULTS:
: t

* Text editing experience
** undo-tree
The undo tree  sets =C-r= to be the same as Vim
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/editing.el
;;; editing.el --- Text editing configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains text editing enhancements:
;; - undo-tree for better undo/redo
;; - Evil mode for Vim emulation
;; - Evil collection for Evil mode compatibility
;; - Evil nerd commenter for commenting
;; - Hydra for text scaling
;; - French typing support (right Option key)

;;; Code:

;; =============================================================================
;; Undo Tree
;; =============================================================================

(use-package undo-tree
  :ensure t
  :init
  :config
  (global-undo-tree-mode 1))
#+end_src

** Evil mod
e
Basic setup including rebind vim like C-u/i for page scroll, =evil-nerd-commenter= : vim commentary parity, the  =evil-collection= ensures evil mode works well in dired, terminal etc.
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/editing.el

;; =============================================================================
;; Evil Mode (Vim Emulation)
;; =============================================================================


  (use-package evil
    :init
    (setq evil-undo-system 'undo-tree);; tell Evil to use undo-tree
    (setq evil-want-integration t)
    (setq evil-want-keybinding nil) (setq evil-want-C-u-scroll t)
    (setq evil-want-C-i-jump nil)
    :config
    (evil-mode 1)
    (define-key evil-insert-state-map (kbd "C-g") 'evil-normal-state)
    (define-key evil-insert-state-map (kbd "C-h") 'evil-delete-backward-char-and-join)

    ;; Use visual line motions even outside of visual-line-mode buffers
    (evil-global-set-key 'motion "j" 'evil-next-visual-line)
    (evil-global-set-key 'motion "k" 'evil-previous-visual-line)

    (evil-set-initial-state 'messages-buffer-mode 'normal)
    (evil-set-initial-state 'dashboard-mode 'normal)
    )


  (use-package evil-nerd-commenter
    ;; :config
    ;; (evilnc-default-hotkeys)
    )
  (define-key evil-normal-state-map "gc" 'evilnc-comment-or-uncomment-lines)

  (use-package evil-collection
    :after (evil magit) ;; Ensure Magit is loaded before Evil-Collection initialized
    :config
    (evil-collection-init))

  ;; Escape key to quit menu
  (global-set-key (kbd "<escape>") 'keyboard-escape-quit)

  ;; Xref keybindings for Evil mode
  (with-eval-after-load 'evil
    (define-key evil-normal-state-map (kbd "gd") #'xref-find-definitions)
    (define-key evil-normal-state-map (kbd "gr") #'xref-find-references))
#+end_src
** Hydra
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/editing.el

;; =============================================================================
;; Hydra (Text Scaling)
;; =============================================================================


  (use-package hydra)
  
  (defhydra hydra-text-scale (:timeout 4)
    "scale text"
    ("j" text-scale-increase "in")
    ("k" text-scale-decrease "out")
    ("q" nil "finished" :exit t))
  (global-set-key (kbd "C-c t") 'hydra-text-scale/body)

#+end_src
**  TODO other experiments
:PROPERTIES:
:ID:       533D8377-75CF-41D4-9E2C-A27BC86583ED
:END:
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/editing.el

;; =============================================================================
;; Other Experiments / Settings
;; =============================================================================

  ;; French typing experience
  (setq mac-right-option-modifier nil) ;; Right Option behaves as Option

    ;; TODO: Try to mimic move lines action
    ;; keymap("x", "J", ":move '>+1<CR>gv-gv", opts)
    ;; keymap("x", "K", ":move '<-2<CR>gv-gv", opts)
    ;; keymap("x", "<A-j>", ":move '>+1<CR>gv-gv", opts)
    ;; keymap("x", "<A-k>", ":move '<-2<CR>gv-gv", opts)

(provide 'editing)
;;; editing.el ends here
#+end_src

* Ivy
 Ivy and counsel enhance the interaction experience

 #+begin_src emacs-lisp :tangle ~/.emacs.d/config/completion.el
;;; completion.el --- Completion frameworks configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains completion and search frameworks:
;; - Ivy: Generic completion frontend
;; - Ivy-rich: Enhanced Ivy display
;; - Counsel: Ivy-enhanced commands
;; - Company: In-buffer completion

;;; Code:

;; =============================================================================
;; Ivy, Ivy-rich, and Counsel
;; =============================================================================

   ;; Note: ivy-rich must be setup after Ivy and counsel
   (use-package ivy
     :ensure t
     :diminish ivy-mode
     :bind (("C-s" . swiper)
            :map ivy-minibuffer-map
            ("TAB" . ivy-alt-done)
            ("C-l" . ivy-alt-done)
            ("C-j" . ivy-next-line)
            ("C-k" . ivy-previous-line)
            :map ivy-switch-buffer-map
            ("C-k" . ivy-previous-line)
            ("C-l" . ivy-done)
            ("C-d" . ivy-switch-buffer-kill)
            :map ivy-reverse-i-search-map
            ("C-k" . ivy-previous-line)
            ("C-d" . ivy-reverse-i-search-kill))
     :config
     (ivy-mode 1))

   (use-package ivy-rich
     :ensure t
     :config
     (ivy-rich-mode 1))

   (use-package counsel
     :ensure t
     :bind (("M-x" . counsel-M-x)
            ("C-x b" . counsel-ibuffer)
            ("C-x C-f" . counsel-find-file)
            ("C-c f" . counsel-recentf))
     :config
     (setq ivy-initial-inputs-alist nil))
 #+end_src
* Theme
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/theme.el
;;; theme.el --- Theme configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains theme configuration:
;; - Zenburn theme (dark mode)
;; - Solarized theme (light mode)
;; - Circadian for automatic theme switching based on location

;;; Code:

  ;; Theme
  (use-package zenburn-theme
    :ensure t
    :config
    (setq zenburn-use-variable-pitch 0)
    (setq zenburn-scale-org-headlines 0)
    (setq zenburn-scale-outline-headlines 0)
    )

  (use-package solarized-theme
    :ensure t
    :config
    (setq solarized-high-contrast-mode-line 0)
    )

  ;; Load Theme by location's sunrise and sunset
  (use-package circadian
    :ensure t
    :config
    ;; Set Toronto as the location for sunrise and sunset times
    (setq calendar-latitude 43.6532
          calendar-longitude -79.3832
          calendar-location-name "Toronto, Canada")
    (setq circadian-themes '((:sunrise . solarized-light-high-contrast)
                             (:sunset  . zenburn)))
    (circadian-setup))

(provide 'theme)
;;; theme.el ends here
#+end_src
* Helpful 
#+begin_src emacs-lisp

  ;; Helpful
  (use-package helpful
    :ensure t
    :custom
    (counsel-describe-function-function #'helpful-callable)
    (counsel-describe-variable-function #'helpful-variable)
    :bind
    ([remap describe-function] . helpful-function)
    ([remap describe-symbol] . helpful-symbol)
    ([remap describe-variable] . helpful-variable)
    ([remap describe-command] . helpful-command)
    ([remap describe-key] . helpful-key))

  (defun describe-thing-at-point ()
    "Show the documentation of the symbol at point."
    (interactive)
    (let ((thing (symbol-at-point)))
      (if thing
          (describe-symbol thing)
        (message "No symbol at point."))))
  (global-set-key (kbd "C-c d") 'describe-thing-at-point)

#+end_src
* General
** Which key
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/keybindings.el
;;; keybindings.el --- Keybinding configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains:
;; - Which-key: Display available keybindings
;; - General: Leader key and keybinding definitions
;; - All SPC-prefixed keybindings for various modes

;;; Code:

;; =============================================================================
;; Which Key
;; =============================================================================

  ;; Which key
  (use-package which-key
    :ensure t
    :diminish
    :config
    (which-key-mode)
    (setq which-key-idle-delay 0.3)
    (setq which-key-prefix-prefix "SPC")
    (setq which-key-allow-evil-operators t)
    )
#+end_src
** Main
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/keybindings.el :noweb yes

;; =============================================================================
;; General (Leader Key Configuration)
;; =============================================================================

  (use-package general
    :ensure t
    :requires which-key
    :config
    <<general-define-leader>>
    <<general-define-first-level>>
    <<general-define-buffer>>
    <<general-define-window>>
    <<general-define-lsp>>
    <<general-define-org>>
    <<general-define-claude>>
    <<general-define-magit>>
    )
#+end_src
** define leader key
#+name: general-define-leader
#+begin_src emacs-lisp
    (general-create-definer leader-key-def
      :states '(normal visual insert emacs)
      :prefix "SPC"
      :non-normal-prefix "M-SPC")
#+end_src
** First level 
#+name: general-define-first-level
#+begin_src emacs-lisp
    (leader-key-def
      "d" 'describe-thing-at-point
      "f" 'counsel-find-file
      "h" 'counsel-command-history
      "p" 'projectile-command-map
      "q" 'delete-window
      "r" 'counsel-recentf
      "w" 'save-buffer
      "R" 'restart-emacs
      "e" 'neotree-toggle :which-key " Neotree"
      "v" 'vterm :which-key " Vterm"
      )
#+end_src
** second level
*** buffer
#+name: general-define-buffer
#+begin_src emacs-lisp
  (leader-key-def
    "b" '(:ignore t :which-key " Buffer...")
    "b l" 'counsel-ibuffer
    "b c" 'kill-buffer
    "b w" 'save-buffer 
    )
#+end_src
*** Window
#+name: general-define-window
#+begin_src emacs-lisp
  (leader-key-def
    "a" '(:ignore t :which-key " Window...")
    "a v" #'split-window-right
    "a s" #'split-window-below
    "a w" #'other-window
    "a o" #'delete-other-windows
    "a h" #'evil-window-left
    "a j" #'evil-window-down
    "a k" #'evil-window-up
    "a l" #'evil-window-right
    "a H" #'evil-window-move-far-left
    "a J" #'evil-window-move-very-bottom
    "a K" #'evil-window-move-very-top
    "a L" #'evil-window-move-far-right)
#+end_src
*** Magit
#+name: general-define-magit
#+begin_src emacs-lisp
    (leader-key-def
      "g" '(:ignore t :which-key " Magit...")
      "g s" 'magit-status
      "g b" 'magit-blame
      "g l" 'magit-log-buffer-file
      "g g" 'magit-dispatch
      "g c" 'magit-commit-create)
#+end_src
*** LSP
#+name: general-define-lisp
#+begin_src emacs-lisp
    (leader-key-def
      "l" '(:ignore t :which-key " LSP...")
      "l r" 'lsp-find-references
      "l d" 'lsp-find-definition
      "l i" 'lsp-find-implementation
      "l D" 'lsp-find-declaration
      "l e" 'lsp-treemacs-errors-list
      )
#+end_src
*** Org
#+name: general-define-org
#+begin_src emacs-lisp
  (leader-key-def
    "o" '(:ignore t :which-key " Org...")
    "o a" 'org-agenda
    "o b" '(org-babel-tangle :which-key "Org Babel Tangle")
    "o c" 'org-capture
    "o d" 'org-deadline
    "o s" 'org-schedule
    "o o" 'org-open-at-point
    "o t" '(counsel-org-tag :which-key "Set Org Tag")
    "o r" '(:ignore t :which-key " Org Roam")
    "o rf" '(org-roam-node-find :which-key "Find a Node")
    "o ri" '(org-roam-node-insert :which-key "Insert a Node")
    "o rr" '(org-roam-buffer-toggle :which-key "Toggle Org Roam Buffer")
    "o it" '(org-toggle-inline-images :which-key "Toggle inline image")
    )
#+end_src
*** Claude
#+name: general-define-claude
#+begin_src emacs-lisp
  (leader-key-def
    "c" '(:ignore t :which-key " Claude Console...")
    "c t" 'claude-code-ide)
#+end_src
** Footer
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/keybindings.el
(provide 'keybindings)
;;; keybindings.el ends here
#+end_src
* Command log mode
#+begin_src emacs-lisp

  ;; Comand log mode
  (use-package command-log-mode
    :ensure t)

#+end_src
* æ‹¼éŸ³
** å¯¼å…¥è¯åº“
*** æ‡’äººè¯åº“
http://tumashu.github.io/pyim-bigdict/pyim-bigdict.pyim.gz
*** æœç‹—è¯åº“
è¿™é‡Œé€‰ç”¨pyimå®˜æ–¹æ¨èçš„å·¥å…·æ¥è½¬æ¢æœç‹—è¯åº“ã€‚
1. é¦–å…ˆåœ¨æœç‹—å®˜ç½‘ä¸‹è½½æƒ³è¦çš„ä¸“ä¸šè¯åº“ https://pinyin.sogou.com/dict/
2. è½¬åŒ–å·¥å…·  https://github.com/E-Neo/scel2pyim

#+begin_src shell
  $ brew install gcc
  $ git clone git@github.com:E-Neo/scel2pyim.git
  $ gcc -o scel2pyim scel2pyim.c
  $ ./scel2pyim NAME.scel NAME.pyim
#+end_src

*** å¯¼å…¥è¯åº“
#+begin_src emacs-lisp
  (setq pyim-dicts
        '((:name "æ‡’äººåŒ…" :file "~/eSync/pyim/lazy.gz")
          (:name "æœç‹—ï¼é¥®é£Ÿå¤§å…¨ï¼ˆå®˜æ–¹æ¨èï¼‰" :file "~/eSync/pyim/food.pyim")))
#+end_src

** Config
#+begin_src emacs-lisp
  ;; æ‹¼éŸ³
  (use-package pyim
    :config
    ;; æ¿€æ´» basedict æ‹¼éŸ³è¯åº“
    (use-package pyim-basedict
      :config (pyim-basedict-enable))
    ;; è®¾ç½® pyim æ¢é’ˆè®¾ç½®ï¼Œè¿™æ˜¯ pyim é«˜çº§åŠŸèƒ½è®¾ç½®ï¼Œå¯ä»¥å®ç° *æ— ç—›* ä¸­è‹±æ–‡åˆ‡æ¢ :-)
    ;; æˆ‘è‡ªå·±ä½¿ç”¨çš„ä¸­è‹±æ–‡åŠ¨æ€åˆ‡æ¢è§„åˆ™æ˜¯ï¼š
    ;; 1. å…‰æ ‡åªæœ‰åœ¨æ³¨é‡Šé‡Œé¢æ—¶ï¼Œæ‰å¯ä»¥è¾“å…¥ä¸­æ–‡ã€‚
    ;; 2. å…‰æ ‡å‰æ˜¯æ±‰å­—å­—ç¬¦æ—¶ï¼Œæ‰èƒ½è¾“å…¥ä¸­æ–‡ã€‚ 
    ;; 3. ä½¿ç”¨ M-j å¿«æ·é”®ï¼Œå¼ºåˆ¶å°†å…‰æ ‡å‰çš„æ‹¼éŸ³å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸­æ–‡ã€‚

   (setq-default pyim-english-input-switch-functions
                  '(pyim-probe-dynamic-english
                    pyim-probe-isearch-mode
                    pyim-probe-program-mode
                    pyim-probe-org-structure-template))
    (setq-default pyim-punctuation-half-width-functions
                  '(pyim-probe-punctuation-line-beginning
                    pyim-probe-punctuation-after-punctuation))
 
    ;; å¼€å¯æ‹¼éŸ³æœç´¢åŠŸèƒ½
    (pyim-isearch-mode 1)

    ;; ;; ä½¿ç”¨ pupup-el æ¥ç»˜åˆ¶é€‰è¯æ¡†
    ;; (setq pyim-page-tooltip 'popup)
    ;; (setq pyim-page-tooltip 'pos-tip)

    ;; é€‰è¯æ¡†æ˜¾ç¤º5ä¸ªå€™é€‰è¯
    ;; (setq pyim-page-length 5)

    ;; è®© Emacs å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ pyim è¯åº“
    (add-hook 'emacs-startup-hook
              #'(lambda () (pyim-restart-1 t)))
    :bind

    (
     ("M-j" . pyim-convert-string-at-point) ;ä¸ pyim-probe-dynamic-english é…åˆ
     ("C-;" . pyim-delete-word-from-personal-buffer)))

#+end_src
* Org Mode
** Main
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-core.el
;;; org-core.el --- Core Org mode configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains core Org mode settings:
;; - Basic org configuration (directories, files, mobile sync)
;; - Org babel for code execution
;; - Org tempo for quick templates
;; - Org inlinetask

;;; Code:

;; =============================================================================
;; Core Org Configuration
;; =============================================================================

  (use-package org
    :ensure t
    :init
    (setq org-ellipsis " â–¼"
          org-hide-emphasis-markers t
          org-directory "~/eSync/org/"
          org-default-notes-file "~/eSync/org/index.org")
    (setq org-agenda-files '("~/eSync/org" "~/eSync/org/roam"))
    ;; Set to the name of the file where new notes will be stored
    (setq org-mobile-inbox-for-pull "~/eSync/org/flagged.org")
    ;; Set to <your Dropbox root directory>/MobileOrg.
    (setq org-mobile-directory "~/Dropbox/Apps/MobileOrg")
    (setq org-startup-indented 1))
#+end_src
** Workflow Configuration
This section is loaded separately in org-workflow.el and org-visual.el
#+begin_src emacs-lisp :tangle no :noweb yes
    :hook (org-mode . my-org-mode-setup)
    :config
    <<org-visual>>
    <<org-custom-tags>>
    <<org-custom-agenda>>
    <<org-custom-capture>>
    <<org-custom-todo>>
#+end_src
** Visual
#+name:org-visual
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-visual.el
;;; org-visual.el --- Org mode visual configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains Org mode visual enhancements:
;; - Visual line and variable pitch modes
;; - Custom faces for headlines and elements
;; - Company mode integration
;; - Visual fill column for centered text
;; - Org superstar for headline bullets
;; - Helper functions for emphasis markup

;;; Code:

  ;; Configure org mode to start with modes that more visual appealing
  ;; - visual-line-mode: wraps lines at window width for easy reading and editing
  ;; - variable-pitch-mode 1: sets the font face to a variable-width font for a more natural and aesthetically pleasing look
  (defun my-org-mode-setup ()
    "Setup visual line and variable pitch modes for Org mode."
    (visual-line-mode)  
    (variable-pitch-mode 1) 
    (setq-local line-spacing 0.2)
    ;;smartly decide when to insert a blank line based on context.
    (setq-local org-blank-before-new-entry
                '((heading . auto)
                  (plain-list-item . auto)))
     ;; (my/org-fixed-pitch-faces)
    )
  ;; Set faces for headings, lists, and other elements
  (custom-set-faces
   ;; Set font and size for headlines
   '(org-level-1 ((t (:inherit outline-1 :height 1.15))))
   '(org-level-2 ((t (:inherit outline-2 :height 1.12))))
   '(org-level-3 ((t (:inherit outline-3 :height 1.09))))
   '(org-level-4 ((t (:inherit outline-4 :height 1.06))))
   '(org-default ((t (:inherit default :height 1.0))))
   '(org-block ((t (:inherit fixed-pitch :height 0.9))))
   '(org-code ((t (:inherit (shadow fixed-pitch) :height 0.9))))
   '(org-link ((t (:inherit link :height 1.0))))
   '(org-ellipsis ((t (:inherit default :weight normal :height 1.0 :underline nil)))))

  ;; This enables company-mode (autocomplete) when youâ€™re editing Org files.
  (add-hook 'org-mode-hook #'company-mode)
  ;;This tells Org to display inline images at their natural size (actual pixel width), rather than scaling them down.
  (setq org-image-actual-width nil)



  ;; feat(visual): center text
  (defun efs/org-mode-visual-fill ()
    (setq visual-fill-column-width 100
      	visual-fill-column-center-text t)
    (visual-fill-column-mode 1))
  

  (use-package visual-fill-column
    :hook (org-mode . efs/org-mode-visual-fill))

  ;; headline bullet
  (use-package org-superstar
    :ensure t
    :hook (org-mode . org-superstar-mode)
    :init
    (setq org-superstar-remove-leading-stars t
  	  org-superstar-leading-bullet " "
          org-hide-leading-stars t
          org-indent-mode-turns-on-hiding-stars t
          org-superstar-prettify-item-bullets t
          org-superstar-headline-bullets-list '("â˜µ" "â—‹" "âœ»" "âœ¿" "â—†" "â–¶" "â—‰" "âš›" "â™ " "â˜¯" "âœ¦" "âš" "â™¢" "âœ¸" "â¬¢"))
    :config
    ;; consistent size for list bullets
    (set-face-attribute 'org-superstar-item nil :height 1.0))

;; Hook to enable visual settings
(add-hook 'org-mode-hook 'my-org-mode-setup)

#+end_src
** Agenda/TODO/Capture
*** Tags
#+name: org-custom-tags
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-workflow.el
;;; org-workflow.el --- Org mode workflow configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains Org mode workflow features:
;; - Custom tags
;; - TODO keywords and states
;; - Custom agenda views
;; - Capture templates

;;; Code:

;; =============================================================================
;; Custom Tags
;; =============================================================================

  (setq org-tag-alist
        '(
  	;; location
          ("home" . ?h)
          ("out task" . ?o)
  	;; device/occasion
          ("computer" . ?d)
          ("phone" . ?m)
  	;; work
          ("work" . ?w)
          ("CP" . ?x)
  	;; personal
  	("chore" . ?c)
          ("finance" . ?f)
          ("relationship" . ?l)
          ("interview" . ?i)
          ("swim" . ?s)
          ("CG" . ?g)
          ("read" . ?r)
  	;; status
          ("planning" . ?n)
          ("backlog" . ?b)
  	))
#+end_src
*** Custom todo
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-workflow.el

;; =============================================================================
;; Custom TODO Keywords
;; =============================================================================

;; TODO â†’ IN-PROGRESS â†’ WAITING â†’ DONE or CANCELED

	- sequence: Defines the order of states.
	- |: Separates active states (left) from completed/closed states (right).
	- Shortcut keys:
		(t), (i), (w), (d), (c) are optional key shortcuts for quickly switching states (e.g., t for TODO).
	- Special markers:
		@: Prompts for a note when transitioning to this state.
		!: Records a timestamp when transitioning to this state.
#+end_src

#+name: org-custom-todo
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-workflow.el
  (setq org-todo-keywords
            '((sequence "TODO(t)" "NEXT(n)" "|" "DONE(d)" "CANCEL(c@)")))

  (setq org-todo-keyword-faces
        '(("TODO" . (:foreground "orange" :weight bold))
          ("NEXT" . (:foreground "yellow" :weight bold))
          ("DONE" . (:foreground "green" :weight bold))
          ("CANCEL" . (:foreground "gray" :weight bold))))

  (setq org-priority-faces
        '((?A . (:foreground "red" :weight bold))
          (?B . (:foreground "orange" :weight bold))
          (?C . (:foreground "green" :weight bold))))

  (setq org-log-done 'time)
  (setq org-agenda-start-with-log-mode t)
  (setq org-log-into-drawer t)

#+end_src
*** Custom agenda
#+name: org-custom-agenda
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-workflow.el

;; =============================================================================
;; Custom Agenda Views
;; =============================================================================


(setq org-agenda-custom-commands
      '(("p" "Planning"
             ((tags-todo "+planning"
                         ((org-agenda-overriding-header "Planning Tasks")))
              (tags-todo "-{.*}"
                         ((org-agenda-overriding-header "Untagged Tasks")))
              (todo ".*" ((org-agenda-files '("~/eSync/org/tasks.org"))
                          (org-agenda-overriding-header "Unprocessed TODO Items")))))

        ("d" "Daily Agenda"
         ((agenda "" ((org-agenda-span 'day)
                      (org-deadline-warning-days 7)))
          (tags-todo "+PRIORITY=\"A\""
                     ((org-agenda-overriding-header "High Priority Tasks")))))

        ("w" "Weekly Review"
         ((agenda ""
                  ((org-agenda-overriding-header "Completed Tasks")
                   (org-agenda-skip-function '(org-agenda-skip-entry-if 'nottodo 'done))
                   (org-agenda-span 'week)))

          (agenda ""
                  ((org-agenda-overriding-header "Unfinished Scheduled Tasks")
                   (org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                   (org-agenda-span 'week)))))))
#+end_src
*** Custom capture
#+name: org-custom-capture
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-workflow.el

;; =============================================================================
;; Capture Templates
;; =============================================================================

    (setq org-capture-templates
          '(("t" "Task" entry (file+olp "~/eSync/org/tasks.org" "Inbox")
             "* TODO %?\n  %U\n  %a\n  %i" :empty-lines 1)

            ("j" "Journal" entry
             (file+olp+datetree "~/eSync/org/journal.org")
             "\n* %<%I:%M %p> - Journal :journal:\n\n%?\n\n"
             :clock-in :clock-resume :empty-lines 1)
    	
            ("f" "French Class Notes" entry
    	 (file+olp+datetree "~/eSync/org/french.org")
  	 "* French Class Notes: %T
  ** General
  %?
  ** Vocabulary
  - Word 1: 
  - Word 2: 
  ** Grammar
  - Rule 1: 
  - Rule 2: 
  ")             
    	))
#+end_src
** TODO organize this block
:PROPERTIES:
:ID:       855F0833-66EB-4BFC-8331-F882C70EAA68
:END:
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-visual.el

;; =============================================================================
;; Helper Functions
;; =============================================================================

  (defun my/org-fixed-pitch-faces () (require 'org-indent) (dolist (face '(org-block org-table org-formula org-code org-indent org-verbatim org-special-keyword org-meta-line org-checkbox)) (set-face-attribute face nil :inherit 'fixed-pitch)) (set-face-attribute 'org-code nil :inherit '(shadow fixed-pitch)) (set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch)) (set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch)) (set-face-attribute 'org-meta-line nil :inherit '(font-lock-comment-face fixed-pitch)) (set-face-attribute 'org-column nil :background nil) (set-face-attribute 'org-column-title nil :background nil))

    ;;  Helper emphasis
      (defun my-wrap-with-stars ()
        "Wrap visual selection with *."
        (interactive)
        (let ((selection (buffer-substring-no-properties
                          (region-beginning) (region-end))))
          (delete-region (region-beginning) (region-end))
          (insert (concat "*" selection "*"))))

      (defun my-wrap-with-tides ()
        "Wrap visual selection with ~."
        (interactive)
        (let ((selection (buffer-substring-no-properties
                          (region-beginning) (region-end))))
          (delete-region (region-beginning) (region-end))
          (insert (concat "~" selection "~"))))

      (defun my-wrap-with-equals ()
        "Wrap visual selection with =."
        (interactive)
        (let ((selection (buffer-substring-no-properties
                          (region-beginning) (region-end))))
          (delete-region (region-beginning) (region-end))
          (insert (concat "=" selection "="))))

      ;; Bind the function to a key combination
      (define-key evil-visual-state-map (kbd "C-*") 'my-wrap-with-stars)
      (define-key evil-visual-state-map (kbd "C-~") 'my-wrap-with-tides)
      (define-key evil-visual-state-map (kbd "C-=") 'my-wrap-with-equals)

      ;; Surround with ANY KEY (chatGPT)
      (defun surround-with-key (beg end key)
        "Surround the region between BEG and END with KEY."
        (interactive "r\nsSurround with: ")
        (goto-char end)
        (insert key)
        (goto-char beg)
        (insert key))

      (general-define-key
       :states '(visual)
       :keymaps 'override
       "s" 'surround-with-key)

(provide 'org-visual)
;;; org-visual.el ends here
#+end_src

# *** Images
# #+begin_src emacs-lisp
#       (use-package org-download
#         :custom
#         (org-download-method 'directory)
#         (org-download-image-dir "~/eSync/org/pictures")
#         (org-download-heading-lvl nil)
#         :config
#         (setq-default org-download-image-org-width 300)
#         (setq-default org-download-image-html-width 300)
#         (add-hook 'dired-mode-hook 'org-download-enable)
#         )
# #+end_src
** Babel
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-core.el

;; =============================================================================
;; Org Babel
;; =============================================================================

  (use-package org-babel
    :ensure nil ; already built-in
    :defer t ; lazy loading
    :config
    ;; Set default languages for org-babel blocks
    (org-babel-do-load-languages
     'org-babel-load-languages
     '((emacs-lisp . t)
       (python . t)
       (shell . t)
       (js . t)
       (typescript . t)
       (css . t)))
    ;; Enable syntax highlighting for code blocks
    (setq org-src-fontify-natively t))

  ;; (use-package ob-js
  ;;   :after org
  ;;   :config
  ;;   ;; Add support for Node.js
  ;;   (setq org-babel-js-cmd "node"))

;; =============================================================================
;; Org Tempo (Quick Templates)
;; =============================================================================

  (use-package org-tempo
    :ensure nil
    :after org
    :config
    (add-to-list 'org-structure-template-alist '("sh" . "src shell"))
     ;; Define a template for quotes
    (add-to-list 'org-structure-template-alist '("q" . "quote"))
    (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp")))

#+end_src

** Roam
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-roam.el
;;; org-roam.el --- Org Roam configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains Org Roam configuration:
;; - Basic Org Roam setup
;; - Custom capture templates for different note types
;; - Leetcode, mistake logs, algorithm templates, weekly reviews

;;; Code:

    (use-package org-roam
      :ensure t
      :init
      (setq org-roam-v2-ack t)
      :custom
      (org-roam-directory "~/eSync/org/roam/")
      (org-roam-db-location "~/eSync/org/roam/org-roam.db")
      :bind (("C-c n l" . org-roam-buffer-toggle)
             ("C-c n f" . org-roam-node-find)
             ("C-c n i" . org-roam-node-insert))
      :config
      (org-roam-setup))

(setq org-roam-capture-templates
      `(("l" "Leetcode Problem" plain
         "%?"
         :if-new (file+head "leetcode/${slug}.org"
                            "#+title: ${title}\n#+filetags: :leetcode:\n\n* ğŸ“Œ Problem Description\n\n* ğŸ’¡ Solution Summary\n\n* âœ… Java Code\n#+begin_src java\n\n#+end_src\n\n* â—ï¸ Pitfalls\n\n* ğŸ” Related Patterns\n\n* ğŸ§  Similar Problems\n")
         :unnarrowed t)

        ("w" "Mistake Log" plain
         "* â—ï¸ Mistake: ${title}\n- Cause:\n- Fix:\n- Correct Solution:\n- Related Notes: [[id:]]\n"
         :if-new (file+head "wrong/${slug}.org"
                            "#+title: Mistake - ${title}\n#+filetags: :wrong:review:\n")
         :unnarrowed t)

        ("a" "Algorithm Template" plain
         "* âœ¨ Overview\n\n* ğŸ§± Java Template\n#+begin_src java\n\n#+end_src\n\n* ğŸ“Œ Key Points\n\n* ğŸ” Common Questions\n- [[id:]]\n- [[id:]]\n"
         :if-new (file+head "algo/${slug}.org"
                            "#+title: ${title}\n#+filetags: :algo:template:\n")
         :unnarrowed t)

        ("r" "Weekly Review" plain
         "* âœ… Solved This Week\n- Number of Problems:\n- Patterns Reviewed:\n- Mistakes:\n\n* ğŸ” Frequent Patterns\n- [[id:]]\n\n* ğŸ¤¯ Confusing Points\n\n* ğŸ“Œ Next Week Goals\n"
         :if-new (file+head "review/${slug}.org"
                            "#+title: Weekly Review ${title}\n#+filetags: :weekly:review:\n")
         :unnarrowed t)))

(provide 'org-roam)
;;; org-roam.el ends here
#+end_src

# *** org roam ui
# [[https://github.com/org-roam/org-roam-ui][[GITHUB] org-roam-ui]]


# #+begin_src emacs-lisp
# (use-package org-roam-ui
#   :straight
#     (:host github :repo "org-roam/org-roam-ui" :branch "main" :files ("*.el" "out"))
#     :after org-roam
# ;;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
# ;;         a hookable mode anymore, you're advised to pick something yourself
# ;;         if you don't care about startup time, use
# ;;  :hook (after-init . org-roam-ui-mode)
#     :config
#     (setq org-roam-ui-sync-theme t
#           org-roam-ui-follow t
#           org-roam-ui-update-on-save t
#           org-roam-ui-open-on-start t))

# #+end_src

** writing experience in org mode
the *M-q* fill current paragraph is very useful to align paragraph, to make it display prettier
https://www.gnu.org/software/emacs/manual/html_node/emacs/Fill-Commands.html
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/org-core.el

;; Org writing experience settings
(setq org-startup-indented t)  ;; Auto-indent headlines and content
(setq org-startup-folded t)    ;; Fold content on startup for better readability

;; =============================================================================
;; Org Inlinetask
;; =============================================================================

;; Create a task from non-heading text, such as a sentence or paragraph
(require 'org-inlinetask)

(provide 'org-core)
;;; org-core.el ends here
#+end_src
* Projectile
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el
;;; development.el --- Development tools configuration -*- lexical-binding: t -*-

;;; Commentary:
;; This module contains development tools:
;; - Treesitter for syntax highlighting
;; - Eglot for LSP support
;; - Projectile for project management
;; - Counsel-projectile integration
;; - Magit for git integration
;; - Markdown mode
;; - Claude Code IDE

;;; Code:

;; =============================================================================
;; Projectile (Project Management)
;; =============================================================================

  ;; Projectile
  (use-package projectile
    :ensure t
    :init
    (setq projectile-completion-system 'ivy)
    :config
    (projectile-mode 1)
    (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map)
    (setq projectile-project-search-path '("~/projects/" "~/projects/backup/"))
    (setq projectile-switch-project-action #'projectile-dired))

  (use-package counsel-projectile
    :ensure t
    :config (counsel-projectile-mode))

#+end_src
* Magit
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el

;; =============================================================================
;; Magit (Git Interface)
;; =============================================================================

(use-package magit
  :ensure t)
#+end_src

* Markdown
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el

;; =============================================================================
;; Markdown Mode
;; =============================================================================

(use-package markdown-mode
  :ensure t
  :mode ("README\\.md\\'" . gfm-mode)
  :init (setq markdown-command "multimarkdown")
  :bind (:map markdown-mode-map
         ("C-c C-e" . markdown-export)))
#+end_src

* Claude Code IDE
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el

;; =============================================================================
;; Claude Code IDE
;; =============================================================================

(use-package claude-code-ide
  :ensure t
  :vc (:url "https://github.com/manzaltu/claude-code-ide.el" :rev :newest)
  :bind ("C-c C-'" . claude-code-ide-menu) ; Set your favorite keybinding
  :config
  (claude-code-ide-emacs-tools-setup)) ; Optionally enable Emacs MCP tools
#+end_src

* Treesitter
** Use treesit-auto
https://github.com/renzmann/treesit-auto

treesit auto is a tool to help treesiter to find the missing major mode. In order to work with format like tsx, we also need some manually tweaks.

here author shared his thought about how emacs-treesit-auto is created
https://robbmann.io/posts/emacs-treesit-auto/

#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el

;; =============================================================================
;; Tree-sitter (Syntax Highlighting)
;; =============================================================================

;; Tree-sitter-auto helps treesitter find the missing major mode
;; Useful for formats like tsx
;; Reference: https://github.com/renzmann/treesit-auto
;; Author's blog: https://robbmann.io/posts/emacs-treesit-auto/

  (use-package treesit-auto
    :custom
    (treesit-auto-install 'prompt)
    :config
    (treesit-auto-add-to-auto-mode-alist 'all)
    (global-treesit-auto-mode))
#+end_src
# 
* LSP
Emacs 29 auto includes eglot, a lightweight, buit-in LSP client. This means you don't need to install or configure external LSP clients unless you prefer the alternatives like lsp-mode.
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/development.el

;; =============================================================================
;; LSP (Language Server Protocol)
;; =============================================================================

;; Emacs 29+ includes eglot, a lightweight, built-in LSP client
;; No need to install external LSP clients unless you prefer alternatives like lsp-mode

  (use-package eglot
  :ensure nil
  :hook ((tsx-ts-mode
          typescript-ts-mode
          js-ts-mode
          python-mode
          java-mode
          c-mode
          c++-mode
          js-mode
          typescript-mode
          go-mode
          rust-mode) . eglot-ensure)
  :config
  ;; Prefer xref for definitions
  (setq xref-show-definitions-function xref-show-xrefs-function))

;; Note: For TypeScript, ensure language servers are installed:
;;   npm install -g @angular/language-service@latest
;;   npm install -g typescript

(provide 'development)
;;; development.el ends here
#+end_src

  ,*Typescript*
  need to ensure language server and typescript server are installed
  ,#+begin_src shell
    npm install -g @angular/language-service@latest
    npm install -g typescript
#+end_src

* Shell
Term
#+begin_src emacs-lisp
  (use-package term
    :config
    (setq explicit-shell-file-name "bash"))
  
  (use-package eterm-256color
    :hook (term-mode . eterm-256color-mode))

#+end_src

vterm
#+begin_src emacs-lisp
(use-package vterm
  :commands vterm
  :config
  (setq term-prompt-regexp "^[^#$%>\n]*[#$%>] *")  ;; Set this to match your custom shell prompt
  (setq vterm-shell "bash")                       ;; Set this to customize the shell to launch
  (setq vterm-max-scrollback 10000))

#+end_src

* MISC
*Restart emacs*

#+begin_src emacs-lisp
  (use-package restart-emacs
    :bind ("C-c x r" . restart-emacs))
;; also bind SPC-R in general
#+end_src

*Joplin Mode*
1. download [[https://discourse.joplinapp.org/t/note-for-emacs-users/623][HERE]]  and load major mode file

#+begin_src emacs-lisp
(load-file "~/.emacs.d/lisp/joplin-mode.el")
#+end_src

2. declare the mode and load 
#+begin_src emacs-lisp
;;++ Joplin mode (on top of Markdown).
(autoload 'joplin-mode "joplin-mode"
   "Major mode for editing Joplin files" t)
; Note that joplin-mode will step down if it is not joplin data.
(add-to-list 'auto-mode-alist '("/[a-f0-9]\\{32\\}\\.md\\'" . joplin-mode))
;;--
#+end_src

3. handle potential issue
issue https://discourse.joplinapp.org/t/note-for-emacs-users/623

set backup file to a specific directory.
#+begin_src emacs-lisp
  (setq backup-directory-alist '(("." . "~/eSync/backups")))
#+end_src 

*Company*
#+begin_src emacs-lisp :tangle ~/.emacs.d/config/completion.el

;; =============================================================================
;; Company (In-buffer Completion)
;; =============================================================================

  (use-package company
    :ensure t
    :config
    (global-company-mode 1))

(provide 'completion)
;;; completion.el ends here
#+end_src

* Yaml mode 
#+begin_src emacs-lisp
(use-package yaml-mode
  :mode (("\\.yml\\'" . yaml-mode)
         ("\\.yaml\\'" . yaml-mode))
  :config
  (add-hook 'yaml-mode-hook
            '(lambda ()
               (define-key yaml-mode-map "\C-m" 'newline-and-indent))))
#+end_src






